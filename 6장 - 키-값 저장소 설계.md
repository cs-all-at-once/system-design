**키-값 저장소(key-value store)**는 키-값 데이터베이스라고도 불리는 **비 관계형(non-relational) 데이터베이스**임
이 저장소에 저장되는 값은 **고유 식별자(identifier)를 키로 가져야 함**
키와 값 사이의 **이런 연결 관계를 "키-값" 쌍(pair)이라고 지칭함**

키-값 쌍에서의 **키는 유일**해야 하며 해당 키에 매달린 **값은 키를 통해서만 접근**할 수 있음

키는 **일반 텍스트**일 수도 있고 **해시 값**일 수도 있음
**성능상**의 이유로, **키는 짧을수록 좋음**

키-값 쌍에서의 값은 문자열일 수도 있고 리스트(list)일 수도 있고 객체(object)일 수도 있음
키-값 저장소는 보통 **값으로 무엇이 오든 상관하지 않음**

키-값 저장소로 널리 알려진 것으로는 **아마존 다이나모**, **memchached**, **레디스** 같은 것들이 있음

이번 장에서는 **put**, **get** 연산을 지원하는 키-값 저장소를 설계해볼 것임

- put(key, value) : 키-값 쌍을 저장소에 저장
- get(key) : 인자로 주어진 키에 매달린 값을 꺼냄

## 문제 이해 및 설계 범위 확정
완벽한 설계란 없음
**읽기**, **쓰기** 그리고 **메모리 사용량** 사이에 어떤 **균형**을 찾고, **데이터의 일관성**과 **가용성** 사이에서 **타협적 결정을 내린 설계**를 만들었다면 쓸만함 답안임

다음 특성을 갖는 키-값 저장소를 설계해 볼것임

- **키-값 쌍의 크기**는 10KB 이하
- **큰 데이터를 저장**할 수 있어야 함
- **높은 가용성**을 제공해야 함. 따라서 시스템은 설사 **장애가 있더라도 빨리 응답**해야함
- **높은 규모 확정성**을 제공해야 함. 따라서 **트래픽 양에 따라 자동적으로 서버 증설/삭제**가 이루어져야 함
- **데이터 일관성 수준은 조정이 가능**해야 함
- **응답 지연시간(latency)이 짧아야 함**

## 단일 서버 키-값 저장소
한 대 서버만 사용하는 키-값 저장소를 설계하는 것은 쉬움
가장 직관적인 방법은 **키-값 쌍 전부를 메모리에 해시 테이블로 저장**하는 것임
그러나 이 접근법은 빠른 속도를 보장하긴 하지만 **모든 데이터를 메모리 안에 두는 것이 불가능할 수도 있다는 약점**을 갖고 있음
이 문제를 해결하기 위한 개선책으로는 다음과 같은 것이 있음

- **데이터 압축(compression)**
- **자주 쓰이는 데이터만 메모리**에 두고 **나머지는 디스크**에 저장

그러나 이렇게 개선한다고 해도, 한 대 서버로 부족한 때가 곧 찾아옴
**많은 데이터를 저장**하려면 **분산 키-값 저장(distributed key-value store)를 만들 필요가 있음**
  
## 분산 키-값 저장소
분산 키-값 저장소는 **분산 해시 테이블이라고도 불림**
**키-값 쌍을 여러 서버에 분산**시키는 탓임
분산 시스템을 설계할 때는 **CAP 정리(Consistency, Availability, Partition Tolerance theorem)를 이해하고 있어야 함**

### CAP 정리
CAP 정리는 **데이터 일관성(Consistency), 가용성(availability), 파티션 감내(partition tolerance)**라는 **세 가지 요구사항을 동시에 만족하는 분산 시스템을 설계하는 것은 불가능하다는 정리**임
각 요구사항의 의미는 다음과 같음

- **데이터 일관성** : 분산 시스템에 접속하는 **모든 클라이언트**는 **어떤 노드에 접속했느냐에 관계없이** 언제나 **같은 데이터**를 보게 되어야 함
- **가용성** : 분산 시스템에 접속하는 **모든 클라이언트**는 **일부 노드에 장애가 발생하더라도** **항상 응답을 받을 수 있어야 함**
- **파티션 감내** : **파티션**은 **두 노드 사이에 통신 장애가 발생하였음**을 의미함. **파티션 감내**는 **네트워크에 파티션이 생기더라도 시스템은 계속 동작하여야 한다**는 것을 의미함

CAP 정리는 이들 가운데 어떤 두가지르 충족하려면 나머지 하나는 반드시 희생되어야 한다는 것을 의미함
키-값 저장소는 앞서 제시한 세 가지 요구사항 가운데 어느 두 가지를 만족하느냐에 따라 다음과 같이 분류할 수 있음

- CP 시스템 : 일관성과 파티션 감내를 지원하는 키-값 저장소. 가용성을 희생함
- AP 시스템 : 가용성과 파티션 감내를 지원하는 키-값 저장소. 데이터 일관성을 희생함
- CA 시스템 : 일관성과 가용성을 지원하는 키-값 저장소. 파티션 감내는 지원하지 않음. 그러나 통상 네트워크 장애는 피할 수 없는 일로 여겨지므로, 분산 시스템은 반드시 파티션 문제를 감내할 수 있도록 설계되어야 함. 그러므로 실세계에 CA 시스템은 존재하지 않음

위 정의만으로는 이해하기 어려우니 몇 가지 구체적인 사례를 살펴보자
분산 시스템에서 데이터는 보통 여러 노드에 복제되어 보관됨
세 대의 복제(replica) 노드 n1, n2, n3에 데이터를 복제하여 보관하는 상황을 가정해 보자

### 이상적 상태
이상적인 환경이라면 네트워크가 파티션되는 상황은 절대로 일어나지 않을 것임
n1에 기록된 데이터는 자동적으로 n2, n3에 복제됨
데이터 일관성과 가용성도 만족됨

### 실세계의 분산 시스템
분산 시스템은 파티션 문제를 피할 수 없음
그리고 파티션 문제가 발생하면 우리는 일관성과 가용성 사이에서 하나를 선택해야 함


### 시스템 컴포넌트
#### 데이터 파티션
#### 데이터 다중화
#### 데이터 일관성
#### 일관성 모델
#### 비 일관성 해소기법: 데이터 버저닝
#### 장애 처리
#### 장애 감지
#### 일시적 장애 처리
#### 영구 장애 처리
#### 데이터 센터 장애 처리
#### 시스템 아키텍처 다이어그램
#### 쓰기 경로
#### 읽기 경로
## 요약
